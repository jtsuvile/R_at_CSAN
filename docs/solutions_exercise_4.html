<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title></title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/flatly.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<link href="site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet" />
<link href="site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet" />

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>




<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 60px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h2 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h3 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h4 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h5 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h6 {
  padding-top: 65px;
  margin-top: -65px;
}
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #ffffff;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->




</head>

<body>


<div class="container-fluid main-container">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">R for data analysis</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">
    <span class="fa fa-home"></span>
     
    Home
  </a>
</li>
<li>
  <a href="exercise_sheet_1.html">Exercises 1</a>
</li>
<li>
  <a href="exercise_sheet_2.html">Exercises 2</a>
</li>
<li>
  <a href="exercise_sheet_3.html">Exercises 3</a>
</li>
<li>
  <a href="exercise_sheet_4.html">Exercises 4</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fa fa-lightbulb-o"></span>
     
    Solutions
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="solutions_exercise_1.html">Solutions 1</a>
    </li>
    <li>
      <a href="solutions_exercise_2.html">Solutions 2</a>
    </li>
    <li>
      <a href="solutions_exercise_3.html">Solutions 3</a>
    </li>
    <li>
      <a href="solutions_exercise_4.html">Solutions 4</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">




</div>


<hr />
<p>title: &quot;Solutions for exercise set 4&quot; output: html_document ---g</p>
<pre class="r"><code># Working on the emotions and pain data set from exercise 2
library(car)
library(apaTables)
library(tidyverse)
# Start by reading in the data
data &lt;- read.csv(&#39;/Users/juusu53/Documents/projects/opetus/R_for_scientists/R_at_CSAN/data/exercise_data.csv&#39;)

# Let&#39;s do the same cleaning up we did in exercise set 2
data$sex &lt;- factor(data$sex, levels=c(1,2), labels=c(&#39;female&#39;,&#39;male&#39;))
data$education &lt;- factor(data$education, levels=c(1,2,3,4), labels=c(&#39;primary&#39;, &#39;secondary&#39;, &#39;vocational&#39;, &#39;university&#39;))

## 4.1 Simple statistical tests

# Q4.1.1
# checking extent of pain in the body for each sex
res &lt;- t.test(data$curr_pain_extent ~ data$sex)
# see the results
res 

# Q4.1.2 
# t stands for test statistic, df stands for the degrees of freedom, p-value tells the p-valua
# you can call these from the results with 
res$statistic
res$parameter
res$p.value
# respectively. Similarly, for confidence interval
res$conf.int
# and means
res$estimate

# Q4.1.3
# for one-sided alternative hypothesis, you need to define which way you assume the 
# difference to be with either &quot;less&quot; or &quot;greater&quot;
t.test(data$curr_pain_extent ~ data$sex, alternative=&#39;greater&#39;)

# Q4.1.4
# built-in help tells us that var.equal parameter controls this
# if we want to specify that we assume equal variances, we can include
# var.equal = TRUE
t.test(data$curr_pain_extent ~ data$sex, var.equal = TRUE)

# 4.2 Testing assumptions

# Q4.2.1
# equality of variances
# our data are not normally distributed (as we learn below) so we&#39;ll use fligner-killeen&#39;s test
# which is very robust against departures from normality
fligner.test(data$curr_pain_extent ~ data$sex)

# Q4.2.2
# In the case of all of these tests, the null hypothesis (H0) is that 
# the two samples have equal variances (i.e. no difference in variances 
# between the groups), and H1 is that there is a difference. Therefore,
# if you get a high p-value, it&#39;s an indication of your samples having
# equal variances (keep H0), and if you get a low p-value, it&#39;s an indication
# of there being a difference and you having to reject H0.

# For the exercise data, we get 
# Fligner-Killeen:med chi-squared = 34.265, df = 1, p-value = 4.809e-09
# The p value is so small that we should reject the null hypothesis

# Q4.2.3

# Plotting tests for normality
hist(data$curr_pain_extent)
qqnorm(data$curr_pain_extent)
qqline(data$curr_pain_extent)
# Looks like the data have very heavy skew

# Q4.2.4
shapiro.test(data$curr_pain_extent)
# nope, definitely not normally distributed!

## 4.3 Regression
# first, let&#39;s only work with rows with no missing values (makes our life easier)
data_complete &lt;- na.omit(data)
# I have decided to use the extent of current pain as the dependent variable. However, it&#39;s coded as 0-1 (proportion of body in pain), let&#39;s change that to show percentages (0-100) instead to get more informative betas
data_complete$curr_pain_percent &lt;- data_complete$curr_pain_extent*100

# Q4.3.1 
# simple regression 
lm(curr_pain_percent ~ work_physical, data=data_complete)

# Q4.3.2 
model1 &lt;- lm(curr_pain_percent ~ work_physical, data=data_complete)
summary(model1)

# Q4.3.3 
# a slightly more complex linear model
model2 &lt;- lm(curr_pain_percent ~ work_sitting + work_physical, data=data_complete)
summary(model2)

# Q4.3.4 
# Comparing the two models 
anova(model1, model2)

# It looks like in this case the more complex model is better than the simpler one (F = 4.57, p = 0.033), so we should keep the information about proportion of work time spent sitting in the model even though it is not as strong of a predictor as proportion of time spent in physically taxing work

# Q4.3.5 
# Output outcome into a pretty table
apa.reg.table(model2)

## Bonus! Logistic regression

# Let&#39;s create a binary variable about whether subject is likely to have or not have depression in this sample, based on their self rated depression (NB: this is not a clinically sound way to do this, this is just for demonstration purposes!)

# let&#39;s do the splitting with tidyverse and save the result to a new data frame
data_with_depression &lt;- data_complete %&gt;% 
  filter(depression &gt;= 7 | depression &lt;= 1) %&gt;% # only select subs with very high or very low depression rating
  mutate(is_depressed = depression &gt;= 7) # create a new logical column is_depressed based on the depression rating

# Now, we can run a logistic regression where dependent variable is the one we just created
bin1 &lt;- glm(formula = is_depressed ~ joy + pain + anxiety, 
    data=data_with_depression,
    family = &#39;binomial&#39;)

# check to see outcome
summary(bin1)

# we can also use the gtsummary package to get the logistic regression stats to a nice table
library(gtsummary)
tbl_regression(bin1, exponentiate = TRUE)
# the results are shown in viewer (in the same quadrant your plots are shown in)

# NB: This package seems to only work if you use glm() function to create your model. If you wanted to use gtsummary to display the results of the linear models, you would need to tweak your code for the linear regression to use glm() instead of lm() </code></pre>

&nbsp;
<style>
* {
  box-sizing: border-box;
}

/* Create three equal columns that floats next to each other */
.column {
  float: left;
  width: 33.33%;
  padding: 10px;
  height: 300px; /* Should be removed. Only for demonstration */
}

/* Clear floats after the columns */
.row:after {
  content: "";
  display: table;
  clear: both;
}
</style>
<hr />
<!-- Add icon library -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<div class="row">
  <div class="column">
  	<p style="text-align: left;"><span style="color: #808080;">Created by <a href="https://users.aalto.fi/~jtsuvile/">Juulia Suvilehto </a>
	<br><em>juulia.suvilehto@iki.fi</em></span>
<br>
    <a href="https://twitter.com/JSuvilehto" class="fa fa-twitter"></a>
    <a href="https://www.linkedin.com/in/suvilehto/" class="fa fa-linkedin"></a>
    <a href="https://github.com/jtsuvile" class="fa fa-github"></a>
</p>
  </div>
  <div class="column">
  	<p style="text-align: right;"><a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-nc-sa/4.0/88x31.png" /></a></p>
  </div>
    <div class="column">
  	<p style="text-align: right;">This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/">Creative Commons Attribution-NonCommercial-ShareAlike 4.0 International License</a></p>
  </div>
</div>


&nbsp;



</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
